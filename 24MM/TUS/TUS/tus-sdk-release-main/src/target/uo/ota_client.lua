--[[ TMC CONFIDENTIAL
 $TUSLibId$
 Copyright (C) 2022 TOYOTA MOTOR CORPORATION
 All Rights Reserved.
]]


local uo = require('uo')

-- FIXME: to be implemented
-- to be decided by a downloader
local DOWNLOAD_DIR = "/tmp/otaclient/"
os.execute("mkdir -p " .. DOWNLOAD_DIR)
local DOWNLOAD_NAME = "downloaded.tup"

local DOWNLOAD_LOCATION = DOWNLOAD_DIR .. DOWNLOAD_NAME

os.execute("mkdir -p " .. DOWNLOAD_DIR)

-- can be regenerated by 'cmake ... --target reqscript.tup'
-- after editing tests/src/target/common/reqscript-params.json
-- (see tests/src/target/common/CMakeLists.txt)
local DUMMY_SRC = "./tests/src/target/common/" .. "/reqscript.tup"

uo.log("!! using fake TUP '" .. DOWNLOAD_NAME .. "' from " .. DOWNLOAD_LOCATION)

return {
  check_update = function (self, states)
    -- FIXME: to be implemented
    -- to be acquired using SED WebAPIs
    uo.log("! NotYet: query available campain")

    local DUMMY_CAMPAIGN_ID = "DUMMY_CAMPAIGN_0"
    return DUMMY_CAMPAIGN_ID
  end,
  download_package = function (id)
    uo.log("! NotYet: download the canpaign (" .. id  ..")", DUMMY_SRC, DOWNLOAD_LOCATION)
    -- ''download'' from a test data
    os.execute("cp " .. DUMMY_SRC .. " " ..DOWNLOAD_LOCATION)
    os.execute('echo -n " => created: " ; ls -ln ' ..DOWNLOAD_LOCATION)

    return DOWNLOAD_LOCATION
  end
}
