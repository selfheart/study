<center>开发手顺</center>

## 1、网址链接

### 1.1环境搭建

http://wiki.iauto.com/wiki/Project:Teslin/%E7%8E%AF%E5%A2%83%E6%9E%84%E7%AD%91

1.2 密钥相关

\\uranus.storm\iBigtom\Users\update\03_Android\04_21MM\09_密钥

\\uranus.storm\iAuto-share\User\update\24MM\02_概要设计\04_OTA安全&key更新方案



### 2、update_engine 调试手顺



1、关闭selinux(否则无法使用IBootControl接口)
    setenforce 0

2、查看update_engine log

```
su
echo 0 > /proc/sys/kernel/printk
setprop persist.log.tag.update_engine V
setprop persist.log.tag S
setprop persist.iauto.log.switch 31
logcat -G 256m && logcat -g
logcat -s update_engine &
```

3、查看UPDATE-COMPOSER log

```
su
echo 0 > /proc/sys/kernel/printk
setprop persist.log.tag.UPDATE-COMPOSER V
setprop persist.log.tag S
setprop persist.iauto.log.switch 31
logcat -G 256m && logcat -g
logcat -s UPDATE-COMPOSER &
```

4、



6、查看分区

super分区

```
lpdump /dev/block/by-name/super
```

 

全部分区

```shell
cat /proc/partitions
```







### ３.AES KEY更新　

#### １.２４ＭＭ　Android１２　环境下支持的ｋｅｙｓｔｏｒｅ 密钥库类型

![image-20230714162036676](C:\Users\jiangzhuangzhuang\study\study\24MM\开发手顺.assets\image-20230714162036676.png)

注意：不同类型的keystore 使用差别很大，存储位置存储方式都有很大差异

#### 2.密钥库选择

加载keystore时，KeyStore.getInstance("填密钥库名称");，目前实测结果

##### 1）AndroidKeyStore 密钥库

<font color='red'>支持外部导入密钥</font>但<font color='red'>keystore的存储路径不可选</font>，keyStore.setEntry(String alias, Entry entry,ProtectionParameter protParam)时已经把密钥存入系统默认路径，不再支持keystore.strore()另存路径。<font color='red'>不支持密钥导出，只能用</font>

使用aeskey加解密时不能使用手动生成的iv，加密和解密操作使用由 Android Keystore 自动生成的随机 IV。

![image-20230717164712780](C:\Users\jiangzhuangzhuang\study\study\24MM\开发手顺.assets\image-20230717164712780.png)

keystore.load(InputStream stream, char[] password)时不支持设置密码

![image-20230718115418148](C:\Users\jiangzhuangzhuang\study\study\24MM\开发手顺.assets\image-20230718115418148.png)

##### 2）jdk（Oracle提供的Java开发工具包）自带密钥库

jks，jceks支持外部导入密钥且存储路径可选

##### 3）BKS密钥库

支持外部导入密钥且存储路径可选。BKS（Bouncy Castle KeyStore）是一种Java密钥库格式，它在Android平台上用于存储密钥和证书。BKS密钥库通常包含对称密钥、私钥、公钥和证书等。

![image-20230717145903711](C:\Users\jiangzhuangzhuang\study\study\24MM\开发手顺.assets\image-20230717145903711.png)